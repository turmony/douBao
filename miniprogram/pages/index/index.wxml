<view class="container">
  <!-- ç»‘å®šç æ˜¾ç¤ºåŒºåŸŸ -->
  <view class="code-section">
    <view class="code-header">
      <view class="code-label">ç»‘å®šç </view>
      <button class="refresh-btn" bindtap="handleRefresh" hover-class="refresh-btn-hover">
        <text class="refresh-icon">â†»</text>
      </button>
    </view>
    <view class="code-display">
      <text class="code-text">{{bindCode}}</text>
    </view>
    <view class="expire-info">æœ‰æ•ˆæœŸè‡³: {{expireTimeStr}}</view>
  </view>

  <!-- çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ -->
  <view class="status-section">
    <view class="status-indicator status-{{sessionStatus}}">
      <view class="status-icon"></view>
      <text class="status-text">{{statusText}}</text>
    </view>
    
    <!-- ç­‰å¾…æ—¶é—´æ˜¾ç¤º -->
    <view class="timer-display" wx:if="{{sessionStatus !== 'waiting' && sessionStatus !== 'completed'}}">
      <text class="timer-label">å¤„ç†æ—¶é•¿:</text>
      <text class="timer-value">{{waitingTime}}</text>
    </view>
    
    <!-- é”™è¯¯ä¿¡æ¯ -->
    <view class="error-msg" wx:if="{{errorMsg}}">
      <text class="error-icon">âš ï¸</text>
      <text class="error-text">{{errorMsg}}</text>
    </view>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <view class="history-section" wx:if="{{historyList.length > 0}}">
    <view class="history-header">
      <view class="history-title">åˆ†æè®°å½•</view>
      <view class="history-count">å…± {{historyList.length}} æ¡</view>
    </view>
    
    <view class="history-list">
      <view 
        class="history-item" 
        wx:for="{{historyList}}" 
        wx:key="id"
      >
        <!-- æ—¶é—´æˆ³å’Œç­‰å¾…æ—¶é•¿ -->
        <view class="item-header">
          <text class="item-time">{{item.timestamp}}</text>
          <text class="item-duration" wx:if="{{item.finalTime || item.waitTime}}">â± {{item.finalTime || item.waitTime}}</text>
        </view>
        
        <!-- å›¾ç‰‡ -->
        <view class="item-image-wrapper">
          <image 
            class="item-image" 
            src="{{item.tempImageUrl}}" 
            mode="widthFix"
            bindtap="previewImage"
            data-index="{{index}}"
            lazy-load="{{true}}"
            show-menu-by-longpress="{{true}}"
          />
        </view>
        
        <!-- ç­”æ¡ˆ -->
        <view class="item-answer">
          <!-- ç­‰å¾…åˆ†æçŠ¶æ€ -->
          <view class="waiting-indicator" wx:if="{{item.status === 'waiting'}}">
            <view class="waiting-dots">
              <text class="dot">â—</text>
              <text class="dot">â—</text>
              <text class="dot">â—</text>
            </view>
            <text class="waiting-text">æ­£åœ¨åˆ†æå›¾ç‰‡...</text>
          </view>
          
          <!-- æµå¼è¾“å‡ºæ—¶æ˜¾ç¤ºåŠ è½½åŠ¨ç”» -->
          <view class="streaming-indicator" wx:elif="{{item.isStreaming && item.status === 'streaming'}}">
            <text class="streaming-dot"></text>
            <text class="streaming-text">æ­£åœ¨ç”Ÿæˆå›ç­”...</text>
          </view>
          
          <!-- é”™è¯¯çŠ¶æ€ -->
          <view class="error-indicator" wx:elif="{{item.status === 'error'}}">
            <text class="error-icon">âŒ</text>
            <text class="error-text">{{item.answer}}</text>
          </view>
          
          <!-- ç­”æ¡ˆå†…å®¹ -->
          <text 
            class="answer-text {{item.isStreaming ? 'streaming' : ''}}" 
            wx:if="{{item.answer && item.status !== 'error'}}"
            selectable="{{true}}"
          >{{item.answer}}</text>
          
          <!-- æµå¼è¾“å‡ºæ—¶çš„å…‰æ ‡æ•ˆæœ -->
          <text class="cursor" wx:if="{{item.isStreaming && item.answer}}">â–Œ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä½¿ç”¨è¯´æ˜ -->
  <view class="instruction-section">
    <view class="instruction-title">ğŸ“– ä½¿ç”¨è¯´æ˜</view>
    <view class="instruction-list">
      <view class="instruction-item">
        <text class="instruction-number">1</text>
        <text class="instruction-text">åœ¨ Windows å®¢æˆ·ç«¯è¾“å…¥ä¸Šæ–¹ç»‘å®šç </text>
      </view>
      <view class="instruction-item">
        <text class="instruction-number">2</text>
        <text class="instruction-text">æˆªå–éœ€è¦åˆ†æçš„å›¾ç‰‡</text>
      </view>
      <view class="instruction-item">
        <text class="instruction-number">3</text>
        <text class="instruction-text">ç­‰å¾… AI å®æ—¶åˆ†æç»“æœ</text>
      </view>
      <view class="instruction-item">
        <text class="instruction-number">4</text>
        <text class="instruction-text">ç‚¹å‡»å›¾ç‰‡å¯æŸ¥çœ‹å¤§å›¾ï¼Œé•¿æŒ‰å¯ä¿å­˜</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€æç¤º -->
  <view class="empty-state" wx:if="{{historyList.length === 0 && sessionStatus === 'waiting'}}">
    <text class="empty-text">ç­‰å¾…ä¸Šä¼ æˆªå›¾...</text>
    <text class="empty-hint">è¯·åœ¨ Windows å®¢æˆ·ç«¯è¾“å…¥ç»‘å®šç åæˆªå›¾</text>
  </view>
</view>